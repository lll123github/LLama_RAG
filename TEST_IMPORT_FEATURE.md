# 🧪 "导入到提示词"功能测试指南

## 修复说明

已修复前端的"导入到提示词"按钮不响应的问题。

## 测试步骤

### 1. 刷新浏览器

```
按 Ctrl+F5 (Windows/Linux) 或 Cmd+Shift+R (Mac)
```

这会清除浏览器缓存，加载最新的前端代码。

### 2. 搜索内容

1. 在右侧搜索框输入关键词（例如："docker"）
2. 点击"搜索"按钮或按 Enter
3. 等待搜索结果显示

### 3. 导入上下文

1. 在搜索结果中找到一个结果
2. 点击该结果下方的蓝色"导入到提示词"按钮
3. **预期结果**: 
   - 聊天框上方会显示一个绿色的提示框
   - 提示框显示 "✓ 已导入上下文: ..." 和一个 "✕" 按钮
   - 光标自动聚焦到聊天输入框

### 4. 发送消息

1. 在聊天框中输入一条消息
2. 按 Enter 发送
3. **预期结果**:
   - 消息会包含已导入的上下文
   - Llama 会基于上下文和消息进行回复

### 5. 清除上下文

1. 点击绿色提示框右侧的 "✕" 按钮
2. **预期结果**:
   - 绿色提示框消失
   - 已导入的上下文被清除

## 测试场景

### 场景1: 基本导入

```
1. 搜索: "python"
2. 点击第一个结果的"导入到提示词"
3. 验证绿色提示框出现
4. 输入: "这是什么？"
5. 验证回复包含导入的上下文
```

### 场景2: 多次导入

```
1. 搜索: "docker"
2. 点击第一个结果的"导入到提示词"
3. 验证绿色提示框显示第一个上下文
4. 搜索: "kubernetes"
5. 点击第一个结果的"导入到提示词"
6. 验证绿色提示框更新为第二个上下文（覆盖第一个）
```

### 场景3: 清除和重新导入

```
1. 搜索: "linux"
2. 点击结果的"导入到提示词"
3. 点击 "✕" 清除上下文
4. 验证绿色提示框消失
5. 再次点击"导入到提示词"
6. 验证绿色提示框重新出现
```

### 场景4: 特殊字符处理

```
1. 搜索包含特殊字符的内容（如: "C++", "Python's", "foo\"bar"）
2. 点击"导入到提示词"
3. 验证没有 JavaScript 错误
4. 验证上下文正确显示
```

## 预期行为

### ✅ 正确的行为

- 点击按钮后立即显示绿色提示框
- 上下文预览正确显示（前50个字符）
- 清除按钮可以正常工作
- 多次导入时会覆盖之前的上下文
- 聊天消息包含导入的上下文

### ❌ 错误的行为

- 点击按钮没有反应
- 浏览器控制台出现 JavaScript 错误
- 上下文显示不完整或乱码
- 清除按钮不工作
- 聊天消息不包含上下文

## 调试步骤

如果功能仍然不工作，请按以下步骤调试：

### 1. 检查浏览器控制台

```
按 F12 打开开发者工具
点击 "Console" 标签
查看是否有错误信息
```

### 2. 检查网络请求

```
点击 "Network" 标签
执行搜索操作
查看 /api/search 请求是否成功（状态码 200）
```

### 3. 检查前端代码

```
点击 "Sources" 标签
查看 templates/unified_index.html 是否包含最新代码
搜索 "data-context-id" 应该能找到
```

### 4. 清除缓存

```
按 Ctrl+Shift+Delete (Windows/Linux) 或 Cmd+Shift+Delete (Mac)
选择 "All time"
勾选 "Cookies and other site data"
点击 "Clear data"
刷新页面
```

## 常见问题

### Q: 点击按钮后没有反应

**A**: 
1. 确保已按 Ctrl+F5 刷新浏览器
2. 检查浏览器控制台是否有错误
3. 检查搜索结果是否正确加载

### Q: 绿色提示框出现但内容为空

**A**:
1. 检查搜索结果是否包含有效的上下文
2. 尝试搜索其他关键词
3. 检查 rag/content/ 目录是否包含文件

### Q: 导入的上下文没有包含在聊天消息中

**A**:
1. 检查绿色提示框是否仍然显示
2. 检查浏览器控制台是否有错误
3. 尝试清除上下文后重新导入

### Q: 浏览器控制台显示错误

**A**:
1. 记下错误信息
2. 检查 unified_app.py 是否正常运行
3. 检查网络连接是否正常

## 性能测试

### 导入响应时间

- **预期**: < 100ms
- **测试方法**: 打开浏览器开发者工具，在 Console 中执行：
  ```javascript
  console.time('import');
  // 点击导入按钮
  console.timeEnd('import');
  ```

### 搜索结果加载时间

- **预期**: < 500ms
- **测试方法**: 在 Network 标签中查看 /api/search 请求的时间

## 兼容性测试

### 浏览器

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

### 设备

- ✅ 桌面
- ✅ 平板
- ✅ 手机

## 完成检查清单

- [ ] 已刷新浏览器 (Ctrl+F5)
- [ ] 已执行基本导入测试
- [ ] 已执行多次导入测试
- [ ] 已执行清除测试
- [ ] 已执行特殊字符测试
- [ ] 浏览器控制台无错误
- [ ] 功能正常工作

## 反馈

如果测试过程中发现问题，请记录：

1. **问题描述**: 具体发生了什么
2. **重现步骤**: 如何重现问题
3. **预期结果**: 应该发生什么
4. **实际结果**: 实际发生了什么
5. **浏览器信息**: 浏览器类型和版本
6. **控制台错误**: 任何 JavaScript 错误信息

---

**修复日期**: 2025-12-13  
**状态**: ✅ 已修复并测试

